!function(){"use strict";function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,e,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",s=o.toStringTag||"@@toStringTag";function a(n,o,r,s){var a=o&&o.prototype instanceof u?o:u,l=Object.create(a.prototype);return i(l,"_invoke",function(n,i,o){var r,s,a,u=0,l=o||[],p=!1,g={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return r=e,s=0,a=t,g.n=n,c}};function d(n,i){for(s=n,a=i,e=0;!p&&u&&!o&&e<l.length;e++){var o,r=l[e],d=g.p,h=r[2];n>3?(o=h===i)&&(a=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=t):r[0]<=d&&((o=n<2&&d<r[1])?(s=0,g.v=i,g.n=r[1]):d<h&&(o=n<3||r[0]>i||i>h)&&(r[4]=n,r[5]=i,g.n=h,s=0))}if(o||n>1)return c;throw p=!0,i}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&d(l,h),s=l,a=h;(e=s<2?t:a)||!p;){r||(s?s<3?(s>1&&(g.n=-1),d(s,a)):g.n=a:g.v=a);try{if(u=2,r){if(s||(o="next"),e=r[o]){if(!(e=e.call(r,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,s<2&&(s=0)}else 1===s&&(e=r.return)&&e.call(r),s<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),s=1);r=t}else if((e=(p=g.n<0)?a:n.call(i,g))!==c)break}catch(e){r=t,s=1,a=e}finally{u=1}}return{value:e,done:p}}}(n,r,s),!0),l}var c={};function u(){}function l(){}function p(){}e=Object.getPrototypeOf;var g=[][r]?e(e([][r]())):(i(e={},r,function(){return this}),e),d=p.prototype=u.prototype=Object.create(g);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,i(t,s,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=p,i(d,"constructor",p),i(p,"constructor",l),l.displayName="GeneratorFunction",i(p,s,"GeneratorFunction"),i(d),i(d,s,"Generator"),i(d,r,function(){return this}),i(d,"toString",function(){return"[object Generator]"}),(n=function(){return{w:a,m:h}})()}function i(t,e,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}i=function(t,e,n,o){function s(e,n){i(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},i(t,e,n,o)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a(i.key),i)}}function s(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(self.webpackChunkargon_dashboard_pro_angular=self.webpackChunkargon_dashboard_pro_angular||[]).push([[943],{3288:function(t,e){e.Z=function(t,e){return[["justo ahora","en un rato"],["hace %s segundos","en %s segundos"],["hace 1 minuto","en 1 minuto"],["hace %s minutos","en %s minutos"],["hace 1 hora","en 1 hora"],["hace %s horas","en %s horas"],["hace 1 d\xeda","en 1 d\xeda"],["hace %s d\xedas","en %s d\xedas"],["hace 1 semana","en 1 semana"],["hace %s semanas","en %s semanas"],["hace 1 mes","en 1 mes"],["hace %s meses","en %s meses"],["hace 1 a\xf1o","en 1 a\xf1o"],["hace %s a\xf1os","en %s a\xf1os"]][e]}},28432:function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.items={},this.count=0}return t.prototype.Add=function(t,e){this.items[t]=e,this.count++},t.prototype.ContainsKey=function(t){return this.items.hasOwnProperty(t)},t.prototype.Count=function(){return this.count},t.prototype.Item=function(t){return this.items[t]},t.prototype.Keys=function(){var t=[];for(var e in this.items)t.push(e);return t},t.prototype.Remove=function(t){var e=this.items[t];return delete this.items[t],this.count--,e},t.prototype.Values=function(){var t=[];for(var e in this.items)t.push(this.items[e]);return t},t}();e.Dictionary=n},46524:function(t,e,n){var i=n(28432),o=function(){function t(){this._Events=new i.Dictionary,this._maxListeners=null}return t.prototype.addListener=function(t,e){return this.on(t,e)},t.prototype.on=function(t,e){return this._registerEvent(t,e,!1),this},t.prototype.once=function(t,e){return this._registerEvent(t,e,!0),this},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this._Events.Item(t),o=this.listenerCount(t);return i&&i.map(function(t){return t.apply(void 0,e)}),0!==o},t.prototype.eventNames=function(){return this._Events.Keys()},t.prototype.getMaxListeners=function(){return null===this._maxListeners?t.defaultMaxListeners:this._maxListeners},t.prototype.setMaxListeners=function(t){return this._maxListeners=t,this},t.prototype.listeners=function(t){return this._Events.Item(t)},t.prototype.listenerCount=function(t){var e=this._Events.Item(t);return void 0===e?0:e.length},t.prototype.removeAllListeners=function(t){var e=this;return t||(t=this._Events.Keys()),t.forEach(function(t){return e._Events.Remove(t)}),this},t.prototype.removeListener=function(t,e){var n=this.listeners(t).filter(function(t){return t===e});return this._Events.Add(t,n),this},t.prototype._registerEvent=function(t,e,n){if(this._ListenerLimitReached(t))console.log("Maximum listener reached, new Listener not added");else{!0===n&&(e=this._createOnceListener(e,t));var i=this._createListeners(e,this.listeners(t));this._Events.Add(t,i)}},t.prototype._createListeners=function(t,e){return e||(e=new Array),e.push(t),e},t.prototype._createOnceListener=function(t,e){var n=this;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return n.removeListener(e,t),t.apply(void 0,i)}},t.prototype._ListenerLimitReached=function(t){return this.listenerCount(t)===this.getMaxListeners()},t.defaultMaxListeners=10,t}();e.ju=o},47943:function(e,i,r){r.r(i),r.d(i,{MapModule:function(){return qt}});var a,c=r(38583),u=r(3679),l=r(75690),p=r(63423),g=r(12640),d=r(46524),h=r(86173),f=r(85135),m=r(83164),v=r(9950),y=r(77124),A=r(87786),Z=r(89691),b=r(33413),_=r(77026),T=r(6983),k=r(40694),x=r(77218),w=r(30931),S=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=(0,w.Pq)(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new k.Z({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:x.Z.POINT,this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getJustify=function(){return this.justify_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=(0,w.Pq)(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setJustify=function(t){this.justify_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}(),q=r(20047),O=r(96407),M=r(29137),E=r(69499),C=r(8239),U=r(22238),P=r(81534),L=r(88259),I=r.n(L),R=r(37716),F=r(84678),N=r(64363),D=r(79765),Y=((a=function(){return s(function t(e){o(this,t),this._api=e,this.mqttMessageSource=new D.xQ,this.positionSource=new D.xQ},[{key:"socketConnect",value:function(t){var e=this,n=this._api.getUser();this.socket&&this.socket.connected||(this.socket=(0,N.io)("".concat(O.h),{query:{id:t,user:n}}),this.socket.on("mqttMessage",function(t){console.log("Mensaje MQTT recibido en frontend:",t),e.mqttMessageSource.next(t)}),this.socket.on("connect",function(){console.log("Conectado al servidor Socket.IO")}),this.socket.on("disconnect",function(){console.log("Desconectado del servidor Socket.IO")}),this.socket.on("error",function(t){console.error("Error en Socket.IO:",t)}))}},{key:"socketPositionConnect",value:function(t){var e=this;this.socketPosition&&this.socketPosition.connected||(this.socketPosition=(0,N.io)("".concat(O.h),{query:{id:t}}),this.socketPosition.on("user-position",function(t){e.positionSource.next(t)}))}},{key:"listenForMqttMessages",value:function(){return this.mqttMessageSource.asObservable()}},{key:"listenForPositions",value:function(){return this.positionSource.asObservable()}},{key:"publishMqttMessage",value:function(t,e,n){this.socket&&(console.log("Enviando mensaje MQTT:",{topic:t,message:e}),this.socket.emit("publishToMqtt",{topic:t,message:e,options:n}))}},{key:"emitEvent",value:function(t,e){this.socket&&this.socket.emit(t,e)}},{key:"disconnect",value:function(){this.socket&&this.socket.disconnect(),this.socketPosition&&this.socketPosition.disconnect()}}])}()).\u0275fac=function(t){return new(t||a)(R.LFG(F.s))},a.\u0275prov=R.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a),J=r(39209),j=r(98295),B=r(49983),Q=["mapCard"],H=function(){var t=function(){return s(function t(e,n,i,r,s,a){o(this,t),this.dialogRef=e,this.dialog=n,this.data=i,this.fb=r,this.api=s,this._socket=a,this.latE=null,this.lngE=null,this.heightE="100%",this.coordinates=[],this.user=i.user,this.idAlert=i.idAlert,this.latE=this.user.lat,this.lngE=this.user.lng},[{key:"ngOnInit",value:function(){this.createForm(),this.getUserPosition(this.user._id),this._socket.socketConnect(this.user._id),this.listenForRealtimeData()}},{key:"listenForRealtimeData",value:function(){var t=this;this.positionSubscription=this._socket.listenForPositions().subscribe(function(e){console.log("RECIBO DATA DE POSICI\xd3N:",e),e&&e.positions&&e.positions.length>0&&(t.coordinates.push({lat:e.positions[0].lat,lng:e.positions[0].lng}),t.mapCard&&t.mapCard.plotRoute(t.coordinates))}),this.mqttSubscription=this._socket.listenForMqttMessages().subscribe(function(e){console.log("RECIBO DATA DE MQTT:",e),e.topic==="alarma/".concat(t.user.access)&&"F"===e.message&&t.showAlert("info","Alarma Desactivada","El usuario ha desactivado la alarma remotamente.","btn btn-info")})}},{key:"postComment",value:function(){var t=this;(0,P.Av)(),this.api.putAlertHeeded(this.idAlert,{description:this.form.value.comment,administrator:this.getUser(),replyDate:new Date}).subscribe(function(e){(0,P.kU)(),t.showAlert("success","Correcto","Alerta atendida correctamente","btn btn-info"),t._socket.publishMqttMessage("alarma/".concat(t.user.access),"F",{qos:2,retain:!0})},function(e){(0,P.kU)(),t.showAlert("error","Error","Algo ha salido mal, intente m\xe1s tarde!","btn btn-info")})}},{key:"ngOnDestroy",value:function(){this.positionSubscription&&this.positionSubscription.unsubscribe(),this.mqttSubscription&&this.mqttSubscription.unsubscribe()}},{key:"convertCoordsToAddress",value:function(){var t=this;this.lastPosition&&this.lastPosition.lat&&this.lastPosition.lng&&this.api.getAddressFromCoords(Number(this.lastPosition.lat),Number(this.lastPosition.lng)).subscribe(function(e){t.user.current_position=e.address.road},function(t){console.log(t)})}},{key:"sendWhatsAppMessage",value:function(t){t.preventDefault();var e="https://wa.me/?text=".concat(encodeURIComponent("Informaci\xf3n:\n\nNombre: ".concat(this.user.name,"\nC\xe9dula: ").concat(this.user.ci,"\nTel\xe9fono: ").concat(this.user.phone,"\nDirecci\xf3n: ").concat(this.user.address,"\nUbicaci\xf3n: https://www.google.com/maps/search/?api=1&query=").concat(this.lastPosition.lat,",").concat(this.lastPosition.lng)));window.open(e,"_blank")}},{key:"getUserPosition",value:function(t){var e=this;this.api.getUserPosition(t).subscribe(function(t){e.lastPosition=t.body.position,e.convertCoordsToAddress()},function(t){console.log("ERR UP: ",t)})}},{key:"createForm",value:function(){this.form=this.fb.group({comment:["",[u.kI.required]]})}},{key:"close",value:function(t){this.dialogRef.close(t)}},{key:"getUser",value:function(){return localStorage.getItem("id-sh")}},{key:"handleCoordinates",value:function(t){console.log("Received coordinates:",t)}},{key:"showAlert",value:function(t,e,i,o){var r=this;return(0,C.Z)(n().m(function s(){return n().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,I().fire({title:e,text:i,type:t,buttonsStyling:!1,confirmButtonClass:o,allowOutsideClick:!1}).then(function(e){e.value&&"info"!==t&&"warning"!==t&&r.close("close")});case 1:return n.a(2,n.v)}},s)}))()}}])}();return t.\u0275fac=function(e){return new(e||t)(R.Y36(U.so),R.Y36(U.uw),R.Y36(U.WI),R.Y36(u.qu),R.Y36(F.s),R.Y36(Y))},t.\u0275cmp=R.Xpm({type:t,selectors:[["app-info-alerts"]],viewQuery:function(t,e){var n;(1&t&&R.Gf(Q,5),2&t)&&(R.iGM(n=R.CRH())&&(e.mapCard=n.first))},decls:55,vars:10,consts:[[1,"modal-header1","text-left","row","mb-1"],[1,"modal-title"],["type","button",1,"close","mt--5","mr--2",3,"click"],[1,"fa","fa-times","icon-modal-close"],[1,"mat-typography"],["autocomplete","off",1,"form-horizontal",3,"formGroup"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"row"],[1,"map-container"],[3,"lat","lng","heightE"],["mapCard",""],[1,"info-card"],["href","#",3,"click"],[1,"fab","fa-whatsapp"],["appearance","outline",1,"col-xs-12","col-sm-12","col-md-12",2,"border","2px #000000"],["matInput","","name","comment","formControlName","comment"],["mat-dialog-actions","","align","end",1,"dialog-footer"],["type","button",1,"btn","btn-fill","btn-info","btn-md",3,"disabled","click"]],template:function(t,e){1&t&&(R.TgZ(0,"div",0),R.TgZ(1,"h6",1),R._uU(2,"Informaci\xf3n alerta"),R.qZA(),R.TgZ(3,"button",2),R.NdJ("click",function(){return e.close()}),R._UZ(4,"i",3),R.qZA(),R.qZA(),R.TgZ(5,"mat-dialog-content",4),R.TgZ(6,"form",5),R.TgZ(7,"div",6),R.TgZ(8,"div",7),R.TgZ(9,"div",6),R.TgZ(10,"div",8),R._UZ(11,"app-map-card",9,10),R.TgZ(13,"div",11),R.TgZ(14,"strong"),R._uU(15,"Usuario"),R.qZA(),R._UZ(16,"br"),R.TgZ(17,"p"),R.TgZ(18,"small"),R._uU(19,"Nombre: "),R.TgZ(20,"strong"),R._uU(21),R.qZA(),R.qZA(),R._UZ(22,"br"),R.TgZ(23,"small"),R._uU(24,"C\xe9dula: "),R.TgZ(25,"strong"),R._uU(26),R.qZA(),R.qZA(),R._UZ(27,"br"),R.TgZ(28,"small"),R._uU(29,"Tel\xe9fono: "),R.TgZ(30,"strong"),R._uU(31),R.qZA(),R.qZA(),R._UZ(32,"br"),R.TgZ(33,"small"),R._uU(34,"Direcci\xf3n: "),R.TgZ(35,"strong"),R._uU(36),R.qZA(),R.qZA(),R._UZ(37,"br"),R.TgZ(38,"small"),R._uU(39,"Direcci\xf3n Actual: "),R.TgZ(40,"strong"),R._uU(41),R.qZA(),R.qZA(),R._UZ(42,"br"),R.TgZ(43,"a",12),R.NdJ("click",function(t){return e.sendWhatsAppMessage(t)}),R._UZ(44,"i",13),R._uU(45," Compartir "),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(46,"div",7),R.TgZ(47,"div",6),R.TgZ(48,"mat-form-field",14),R.TgZ(49,"mat-label"),R._uU(50,"Motivo de alerta"),R.qZA(),R._UZ(51,"input",15),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(52,"div",16),R.TgZ(53,"button",17),R.NdJ("click",function(){return e.postComment()}),R._uU(54," Guardar "),R.qZA(),R.qZA()),2&t&&(R.xp6(6),R.Q6J("formGroup",e.form),R.xp6(5),R.Q6J("lat",e.latE)("lng",e.lngE)("heightE",e.heightE),R.xp6(10),R.Oqu(e.user.name),R.xp6(5),R.Oqu(e.user.ci),R.xp6(5),R.Oqu(e.user.phone),R.xp6(5),R.Oqu(e.user.address),R.xp6(5),R.Oqu(e.user.current_position),R.xp6(12),R.Q6J("disabled",!e.form.valid))},directives:[U.xY,u._Y,u.JL,u.sg,J.P,j.KE,j.hX,B.Nt,u.Fj,u.JJ,u.u,U.H8],styles:[".map-container[_ngcontent-%COMP%]{position:relative;width:100%;height:55vh}.info-card[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;background-color:#fff;padding:10px;border-radius:5px;box-shadow:0 2px 5px #0003;z-index:100}"]}),t}(),G=r(22176),V=["second","minute","hour","day","week","month","year"],X=["\u79d2","\u5206\u949f","\u5c0f\u65f6","\u5929","\u5468","\u4e2a\u6708","\u5e74"],W={},z=function(t,e){W[t]=e},$=[60,60,24,7,365/7/12,12];function K(t){return t instanceof Date?t:!isNaN(t)||/^\d+$/.test(t)?new Date(parseInt(t)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(t))}var tt=function(t,e,n){var i=function(t,e){return(+(e?K(e):new Date)-+K(t))/1e3}(t,n&&n.relativeDate);return function(t,e){for(var n=t<0?1:0,i=t=Math.abs(t),o=0;t>=$[o]&&o<$.length;o++)t/=$[o];return(t=Math.floor(t))>(0==(o*=2)?9:1)&&(o+=1),e(t,o,i)[n].replace("%s",t.toString())}(i,function(t){return W[t]||W.en_US}(e))};z("en_US",function(t,e){if(0===e)return["just now","right now"];var n=V[Math.floor(e/2)];return t>1&&(n+="s"),[t+" "+n+" ago","in "+t+" "+n]}),z("zh_CN",function(t,e){if(0===e)return["\u521a\u521a","\u7247\u523b\u540e"];var n=X[~~(e/2)];return[t+" "+n+"\u524d",t+" "+n+"\u540e"]});var et=r(3288),nt=r(51095),it=r(76627);function ot(t,e){1&t&&(R.TgZ(0,"div",9),R._UZ(1,"i",10),R.qZA())}var rt=function(){return{color:"green"}};function st(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"wifi"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6,"En l\xednea"),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(6,rt)),R.xp6(6),R.Oqu(n.connectedTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,3,n.connectedAt,"dd/MM/yy HH:mm"))}}var at=function(){return{color:"red"}};function ct(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"wifi"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6,"Fuera de l\xednea"),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(6,at)),R.xp6(6),R.Oqu(n.connectedTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,3,n.connectedAt,"dd/MM/yy HH:mm"))}}function ut(t,e){1&t&&(R.TgZ(0,"div",9),R._UZ(1,"i",10),R.qZA())}function lt(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"power"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6,"Revisi\xf3n conectado"),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(6,rt)),R.xp6(6),R.Oqu(n.powerOutageTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,3,n.powerOutageAt,"dd/MM/yy HH:mm"))}}function pt(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"power"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6,"Revisi\xf3n desconectado"),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(6,at)),R.xp6(6),R.Oqu(n.powerOutageTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,3,n.powerOutageAt,"dd/MM/yy HH:mm"))}}function gt(t,e){1&t&&(R.TgZ(0,"div",9),R._UZ(1,"i",10),R.qZA())}function dt(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"battery_alert"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(7,at)),R.xp6(4),R.hij("",n.batteryStatus,"V"),R.xp6(2),R.Oqu(n.batteryStatusTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,4,n.batteryStatusAt,"dd/MM/yy HH:mm"))}}function ht(t,e){if(1&t&&(R.TgZ(0,"div",11),R.TgZ(1,"div",12),R.TgZ(2,"mat-icon",13),R._uU(3,"battery_alert"),R.qZA(),R.qZA(),R.TgZ(4,"div",14),R.TgZ(5,"div"),R._uU(6),R.qZA(),R.TgZ(7,"div"),R._uU(8),R.qZA(),R.TgZ(9,"div"),R._uU(10),R.ALo(11,"date"),R.qZA(),R.qZA(),R.qZA()),2&t){var n=R.oxw();R.xp6(2),R.Q6J("ngStyle",R.DdM(7,rt)),R.xp6(4),R.hij("",n.batteryStatus,"V"),R.xp6(2),R.Oqu(n.batteryStatusTimeAgo),R.xp6(2),R.Oqu(R.xi3(11,4,n.batteryStatusAt,"dd/MM/yy HH:mm"))}}function ft(t,e){if(1&t){var n=R.EpF();R.TgZ(0,"div",15),R.TgZ(1,"button",16),R.NdJ("click",function(){var t=R.CHM(n).$implicit;return R.oxw().sendCommand(t)}),R._uU(2),R.qZA(),R.qZA()}if(2&t){var i=e.$implicit;R.xp6(2),R.Oqu(i.text)}}var mt=function(){var t=function(){return s(function t(e,n,i,r,s,a){o(this,t),this.dialogRef=e,this.dialog=n,this.data=i,this.events=r,this.socketService=s,this.apiService=a,this.name="",this.identifier="",this.alerts=[{text:"SOS",value:"1"},{text:"SOSPECHOSO",value:"2"},{text:"INUNDACI\xd3N",value:"6"},{text:"TERREMOTO",value:"7"},{text:"DISUASIVA",value:"10"},{text:"LIBADORES",value:"11"},{text:"EXTORSIONADOR",value:"12"},{text:"P0",value:"13"},{text:"P1",value:"14"},{text:"P2",value:"15"}],this.icons=[],this.connected="",this.connectedAt=new Date,this.connectedTimeAgo="",this.powerOutage="",this.powerOutageAt=new Date,this.powerOutageTimeAgo="",this.doorOpen="",this.doorOpenAt=new Date,this.doorOpenTimeAgo="",this.batteryStatus=null,this.batteryStatusAt=new Date,this.batteryStatusTimeAgo="",this.threshold=12,z("es",et.Z),this.name=i.name,this.identifier=i.identifier},[{key:"ngOnInit",value:function(){this.getLastStats(),this.socketService.socketConnect("actions-".concat(this.identifier))}},{key:"getLastStats",value:function(){var t=this;this.apiService.getCentralInformationLast("battery-status",this.identifier).subscribe(function(e){t.batteryStatus=e.boxStats[0].batteryStatus,t.batteryStatusAt=new Date(e.boxStats[0].createdAt),t.batteryStatusTimeAgo=tt(t.batteryStatusAt,"es")}),this.apiService.getCentralInformationLast("sensor-status",this.identifier).subscribe(function(t){console.log("sensor status",t)}),this.apiService.getCentralInformationLast("power-outage",this.identifier).subscribe(function(e){t.powerOutage=e.boxStats[0].powerOutage,t.powerOutageAt=new Date(e.boxStats[0].createdAt),t.powerOutageTimeAgo=tt(t.powerOutageAt,"es")}),this.apiService.getCentralInformationLast("connected",this.identifier).subscribe(function(e){t.connected=e.boxStats[0].connected,t.connectedAt=new Date(e.boxStats[0].createdAt),t.connectedTimeAgo=tt(t.connectedAt,"es")})}},{key:"sendCommand",value:function(t){this.socketService.publishMqttMessage("alarma/".concat(this.identifier),t.value,{qos:1,retain:!0}),console.log("Comando enviado: alarma/".concat(this.identifier," = ").concat(t.value))}},{key:"close",value:function(t){this.dialogRef.close({opt:t})}}])}();return t.\u0275fac=function(e){return new(e||t)(R.Y36(U.so),R.Y36(U.uw),R.Y36(U.WI),R.Y36(d.ju),R.Y36(Y),R.Y36(F.s))},t.\u0275cmp=R.Xpm({type:t,selectors:[["app-actions"]],decls:19,vars:11,consts:[["mat-dialog-title","",1,"mat-typography"],[1,"status-container"],["class","loading-spinner",4,"ngIf"],["class","status-item",4,"ngIf"],[1,"grid-container"],["class","grid-item",4,"ngFor","ngForOf"],[1,"center-button-container"],["mat-button","",1,"custom-mat-button-red",3,"click"],["tabindex","-1","cdkFocusInitial",""],[1,"loading-spinner"],[1,"fas","fa-spinner","fa-spin"],[1,"status-item"],[1,"icon-container"],[3,"ngStyle"],[1,"text-container"],[1,"grid-item"],["mat-button","",1,"custom-mat-button",3,"click"]],template:function(t,e){1&t&&(R.TgZ(0,"h2",0),R._uU(1),R.qZA(),R.TgZ(2,"mat-dialog-content"),R.TgZ(3,"div",1),R.YNc(4,ot,2,0,"div",2),R.YNc(5,st,12,7,"div",3),R.YNc(6,ct,12,7,"div",3),R.YNc(7,ut,2,0,"div",2),R.YNc(8,lt,12,7,"div",3),R.YNc(9,pt,12,7,"div",3),R.YNc(10,gt,2,0,"div",2),R.YNc(11,dt,12,8,"div",3),R.YNc(12,ht,12,8,"div",3),R.qZA(),R.TgZ(13,"div",4),R.YNc(14,ft,3,1,"div",5),R.qZA(),R.TgZ(15,"div",6),R.TgZ(16,"button",7),R.NdJ("click",function(){return e.sendCommand({value:"0"})}),R._uU(17,"Apagar"),R.qZA(),R.qZA(),R.qZA(),R._UZ(18,"div",8)),2&t&&(R.xp6(1),R.Oqu(e.name),R.xp6(3),R.Q6J("ngIf",null==e.connected||""==e.connected),R.xp6(1),R.Q6J("ngIf","1"==e.connected),R.xp6(1),R.Q6J("ngIf","1"!=e.connected&&null!=e.connected&&""!=e.connected),R.xp6(1),R.Q6J("ngIf",null==e.powerOutage||""==e.powerOutage),R.xp6(1),R.Q6J("ngIf","1"==e.powerOutage),R.xp6(1),R.Q6J("ngIf","1"!=e.powerOutage&&null!=e.powerOutage&&""!=e.powerOutage),R.xp6(1),R.Q6J("ngIf",null==e.batteryStatus),R.xp6(1),R.Q6J("ngIf",e.batteryStatus<=e.threshold&&null!=e.batteryStatus),R.xp6(1),R.Q6J("ngIf",e.batteryStatus>e.threshold&&null!=e.batteryStatus),R.xp6(2),R.Q6J("ngForOf",e.alerts))},directives:[U.uh,U.xY,c.O5,c.sg,nt.lW,it.Hw,c.PC],pipes:[c.uU],styles:['@charset "UTF-8";.btn-actions[_ngcontent-%COMP%]{height:100%!important;width:120%;display:flex;justify-content:center;align-items:center;border:1px solid gray;border-radius:100%;margin-left:auto;margin-right:auto;text-align:center!important}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:10px;gap:10px}.grid-item[_ngcontent-%COMP%]{display:flex;justify-content:center}button[mat-button][_ngcontent-%COMP%]{width:100%}.custom-mat-button[_ngcontent-%COMP%]{border:2px solid #ADD8E6!important;border-radius:8px!important;background-color:transparent!important}.custom-mat-button[_ngcontent-%COMP%]:hover{background-color:#add8e6!important;color:#fff!important}.custom-mat-button-red[_ngcontent-%COMP%]{border:2px solid #E57373!important;border-radius:8px!important;background-color:transparent!important}.custom-mat-button-red[_ngcontent-%COMP%]:hover{background-color:#e57373!important;color:#fff!important}.center-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:20px;margin-left:30%;margin-right:30%}.status-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;grid-gap:10px;gap:10px;margin-top:20px;margin-bottom:40px}.status-item[_ngcontent-%COMP%]{display:flex;align-items:center;grid-gap:10px;gap:10px}.icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px}.text-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}']}),t}(),vt=r(88975),yt=r(76509),At=function(){var t=function(){return s(function t(e){o(this,t),this.toastr=e},[{key:"showSuccess",value:function(t,e){this.toastr.success(t,e,{positionClass:"toast-top-left"})}},{key:"showError",value:function(t,e){this.toastr.error(t,e,{positionClass:"toast-top-left"})}},{key:"showInfo",value:function(t,e){this.toastr.info(t,e,{positionClass:"toast-top-left"})}},{key:"showWarning",value:function(t,e){this.toastr.warning(t,e,{positionClass:"toast-top-left"})}}])}();return t.\u0275fac=function(e){return new(e||t)(R.LFG(yt._W))},t.\u0275prov=R.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Zt=r(67441),bt=r(72458),_t=["audioPlayer"];function Tt(t,e){if(1&t&&(R.TgZ(0,"mat-option",23),R._uU(1),R.qZA()),2&t){var n=e.$implicit;R.Q6J("value",n._id),R.xp6(1),R.hij(" TEAM - ",n.name," ")}}function kt(t,e){1&t&&R._UZ(0,"i",24)}function xt(t,e){if(1&t){var n=R.EpF();R.TgZ(0,"div",25),R.TgZ(1,"span",26),R.NdJ("click",function(){var t=R.CHM(n).$implicit;return R.oxw().showAlertInfo(t)}),R.TgZ(2,"mat-icon"),R._uU(3,"notifications_active"),R.qZA(),R.qZA(),R.TgZ(4,"div",27),R.TgZ(5,"div",28),R.TgZ(6,"div"),R.TgZ(7,"span",29),R._uU(8),R.qZA(),R._UZ(9,"br"),R.TgZ(10,"small",30),R._uU(11),R.qZA(),R.qZA(),R.TgZ(12,"div",31),R.TgZ(13,"small",32),R._UZ(14,"i",33),R._uU(15),R.ALo(16,"date"),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA()}if(2&t){var i=e.$implicit,o=R.oxw();R.xp6(8),R.AsE(" ",o.getTypeAlert(i.type).type," - ",i.access.name," "),R.xp6(3),R.Oqu(i.user.name),R.xp6(4),R.hij(" ",R.xi3(16,4,i.date,"HH:mm")," ")}}var wt=[{path:"",children:[{path:"",component:function(){var e=function(){return s(function t(e,n,i,r,s){o(this,t),this._api=e,this.fb=n,this.dialog=i,this.notifyService=r,this.socketService=s,this.isLoadingAlerts=!1,this.isConnect=!1,this.alerts=[],this.markers={},this.fit=!0,this.fitF=!0,this.center=!1,this.word="",this.teams=[],this.neighborhoods=[],this.pagination={page:1,pages:1,itemsPage:500,total:1},this.wordToSearch="",this.teamsCtrl=new u.NI,this.layerRegistry={},this.isSound=!1,this.isBouncing=!1,this.singleClickListener=null,this.topicMessageCount={}},[{key:"ngOnInit",value:function(){var t=this;this.loadOpenStreet(),this.createForm(),this.getTeams(),this.listenMqttMessages(),this.map.getView().on("change:resolution",function(){var e=t.map.getView().getZoom();t.updateMarkerStyles(e)})}},{key:"updateMarkerStyles",value:function(t){for(var e in this.markers)if(this.markers.hasOwnProperty(e)){var n=this.markers[e],i=n.getStyle(),o=i.getText();o||(o=new S({})),o.setText(n.get("name")),o.setFont("10px sans-serif"),i.setText(o),n.setStyle(i)}}},{key:"listenMqttMessages",value:function(){var t=this;this.socketService.socketConnect("map-component"),this.socketService.listenForMqttMessages().subscribe(function(e){var n=e.topic,i=e.message,o=n.split("/")[1];if(n.includes("alarma")){if(console.log("ENTRA EN TOPIC ALARMA:",n,i),i.toString().includes("0"))return;t.manageAlarms(o,i)}console.log("MENSAJE MQTT RECIBIDO:",n,i);var r=t.neighborhoods.find(function(t){return t.identifier===o}),s=i.toString().substring(0,1),a=i.toString().substring(1,i.toString().length);r&&t.typesAlert(r,s,a)})}},{key:"manageAlarms",value:function(t,e){if(this.topicMessageCount[t]||(this.topicMessageCount[t]=0),console.log("SUENA: ",this.topicMessageCount),this.topicMessageCount[t]++,this.topicMessageCount[t]>1){this.getAlerts();var n=e.toString("utf-8");if(console.log("ESTO 1: ",n),n.includes("out")){console.log("ENTRA EN OUT");var i=JSON.parse(n.split("*")[1]);if(this.notifyService.showError("Fuera de cobertura","".concat(i.name," - Emiti\xf3 una alerta")),!this.markers[i._id]){var o=new b.Z({geometry:new _.Z([parseFloat(i.lng),parseFloat(i.lat)]).transform("EPSG:4326","EPSG:3857"),name:i.name,id:i._id});this.markers[i._id]=o}return}Number(n)<10&&(console.log("ENTRA EN ESTO con IS NUMBER"),this.changePinColor(t))}}},{key:"typesAlert",value:function(t,e,n){switch(e){case"C":"0"===n?"Central corte de corriente":"Revisi\xf3n estado corriente correcto";break;case"D":"0"===n?("Central fuera de l\xednea",this.setMarkerStyle(this.markers[t.identifier],"pin-disconnect")):("Central central en l\xednea",this.setMarkerStyle(this.markers[t.identifier],"pin"));break;case"P":"0"===n?"Puerta central abierta":"Puerta central cerrada";break;case"B":"Estado de la bateria ".concat(n)}}},{key:"createForm",value:function(){this.searchForm=this.fb.group({value:[this.teams[0]]})}},{key:"centerMap",value:function(){var t=this.neighborhoods.map(function(t){return[parseFloat(t.lng),parseFloat(t.lat)]}),e=t.reduce(function(t,e){return[t[0]+e[0],t[1]+e[1]]},[0,0]);e[0]/=t.length,e[1]/=t.length,this.map.getView().setCenter((0,E.mi)(e));var n=this.calculateZoomForPoints(this.neighborhoods);this.map.getView().setZoom(n)}},{key:"clearMapState",value:function(){for(var t in this.markers={},this.topicMessageCount={},this.layerRegistry)this.layerRegistry.hasOwnProperty(t)&&this.map.removeLayer(this.layerRegistry[t]);this.layerRegistry={},this.neighborhoods=[],this.singleClickListener&&((0,vt.B)(this.singleClickListener),this.singleClickListener=null)}},{key:"setMarker",value:function(t,e){if(t)t.set("connected",e.connected),this.setMarkerStyle(t,e.connected?"pin":"pin-disconnect");else{var n=new b.Z({geometry:new _.Z([parseFloat(e.lng),parseFloat(e.lat)]).transform("EPSG:4326","EPSG:3857"),name:e.name,connected:e.connected,identifier:e.identifier});this.markers[e.identifier]=n,this.setMarkerStyle(n,e.connected?"pin":"pin-disconnect")}}},{key:"setMarkerStyle",value:function(t,e){var n=new S({text:"",offsetY:12,fill:new k.Z({color:"black"}),font:"bold 14px Arial",backgroundFill:new k.Z({color:"white"}),padding:[3,3,3,3]});this.markerStyle=new T.ZP({image:new M.Z({crossOrigin:"anonymous",anchor:[24,48],anchorXUnits:q.Z.PIXELS,anchorYUnits:q.Z.PIXELS,src:"".concat(O.U,"/view/").concat(e)}),text:n});var i=this.markerStyle.getText();i||(i=new S({})),i.setText(t.get("name")),i.setFont("10px sans-serif"),this.markerStyle.setText(i),t.setStyle(this.markerStyle)}},{key:"getNeighborhoodByTeam",value:function(t){var e=this;this.clearMapState(),this._api.getNeighborhoodByTeam(t,this.pagination.page,this.pagination.itemsPage,this.wordToSearch).subscribe(function(t){e.neighborhoods=t.body.neighborhoods,e.centerMap(),e.neighborhoods.forEach(function(t){console.log("Monitoring neighborhood:",t.identifier),e.setMarker(e.markers[t.identifier],t);var n=new Z.Z({features:[e.markers[t.identifier]]}),i=new A.Z({source:n});i.set("layerId",t._id),e.layerRegistry[t._id]=i,e.map.addLayer(i)}),e.singleClickListener&&(0,vt.B)(e.singleClickListener),e.singleClickListener=e.map.on("singleclick",function(t){e.map.forEachFeatureAtPixel(t.pixel,function(t,n){if(t){var i=t.get("name"),o=t.get("connected"),r=t.get("identifier");e.dialog.open(mt,{width:"60%",data:{name:i,connected:o,identifier:r}})}})})})}},{key:"calculateZoomForPoints",value:function(e){if(0===e.length)return 2;var n=Math.min.apply(Math,t(e.map(function(t){return parseFloat(t.lng)}))),i=Math.min.apply(Math,t(e.map(function(t){return parseFloat(t.lat)}))),o=Math.max.apply(Math,t(e.map(function(t){return parseFloat(t.lng)})))-n,r=Math.max.apply(Math,t(e.map(function(t){return parseFloat(t.lat)})))-i,s=document.getElementById("map"),a=Math.max(o/s.clientWidth,r/s.clientHeight);return Math.log2(360/(256*a))-1}},{key:"loadOpenStreet",value:function(){this.map=new h.Z({controls:(0,y.ce)({zoom:!1,rotate:!1}),target:"map",layers:[new m.Z({source:new v.Z({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"})})],view:new f.ZP({center:[0,0],zoom:2,maxZoom:19,minZoom:2})})}},{key:"getTeams",value:function(){var t=this;this._api.getTeams(this.pagination.page,this.pagination.itemsPage,this.wordToSearch).subscribe(function(e){t.teams=e.body.teams,t.teams.length>0&&(t.searchForm.patchValue({value:t.teams[0]._id}),t.selected(t.searchForm.value.value))})}},{key:"selected",value:function(t){this.markers={},this.neighborhoods=[],this.getNeighborhoodByTeam(t),this.teamSelectedId=t,this.alerts=[],this.getAlerts()}},{key:"getAlerts",value:function(){var t=this;this.isLoadingAlerts=!0,this._api.getAlertsByTeam(this.teamSelectedId).subscribe(function(e){t.alerts=e.body.alerts,t.isLoadingAlerts=!1},function(t){(0,G.w)("error","Error","Algo ha salido mal, intente m\xe1s tarde!\n".concat(t),"btn btn-info")})}},{key:"changePinColor",value:function(t){var e=this;if(t&&this.markers[t]){for(var n=function(n){setTimeout(function(){19===n&&(e.setMarkerStyle(e.markers[t],"pin"),e.stopSound()),e.setMarkerStyle(e.markers[t],n%2==0?"pin4":e.markers[t].get("connected")?"pin":"pin-disconnect")},500*n)},i=0;i<20;i++)n(i);this.isSound||this.playSound()}}},{key:"getTypeAlert",value:function(t){var e,n,i="assets/img/icons/rumi_black.png";switch(t){case"ALERT_1":e="ALERTA DE SOS",n="assets/img/alerts/policebtn.png";break;case"ALERT_2":e="ALERTA DE SOSPECHOSO",n="assets/img/alerts/suspect.png";break;case"ALERT_3":e="ALERTA SILENCIOSA",n="assets/img/alerts/silencio.png";break;case"ALERT_4":e="ALERTA DE MI UBICACI\xd3N",n=i;break;case"ALERT_5":e="ALERTA DE VIOLENCIA DE G\xc9NERO",n="assets/img/alerts/genero.png";break;case"ALERT_6":e="ALERTA DE INUNDACI\xd3N",n="assets/img/alerts/flood.png";break;case"ALERT_7":e="ALERTA DE TERREMOTO",n="assets/img/alerts/earthquake.png";break;case"ALERT_10":e="ALERTA DISUASIVA",n=i;break;case"ALERT_11":e="ALERTA DE LIBADORES",n=i;break;case"ALERT_12":e="ALERTA DE EXTORSIONADOR",n=i;break;case"ALERT_13":e="ALERTA P0",n=i;break;case"ALERT_14":e="ALERTA P1",n=i;break;case"ALERT_15":e="ALERTA P2",n=i}return{type:e,img:n}}},{key:"playSound",value:function(){this.audioPlayer.nativeElement.play()}},{key:"stopSound",value:function(){var t=this.audioPlayer.nativeElement;t.pause(),t.currentTime=0}},{key:"showAlertInfo",value:function(t){var e=this;this.dialog.open(H,{width:"60%",data:{user:t.user,idAlert:t._id}}).afterClosed().subscribe(function(t){void 0!==t&&(e.alerts=[],e.getAlerts())})}}])}();return e.\u0275fac=function(t){return new(t||e)(R.Y36(F.s),R.Y36(u.qu),R.Y36(U.uw),R.Y36(At),R.Y36(Y))},e.\u0275cmp=R.Xpm({type:e,selectors:[["app-map"]],viewQuery:function(t,e){var n;(1&t&&R.Gf(_t,5),2&t)&&(R.iGM(n=R.CRH())&&(e.audioPlayer=n.first))},decls:33,vars:4,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12"],[1,"card"],[1,"header"],[1,"h4","title"],["title","Centrar",2,"float","right","cursor","pointer",3,"click"],[1,"category"],[1,"form-horizontal",3,"formGroup"],["id","map",1,"map"],["appearance","outline",1,"col-xs-3","col-sm-3","col-md-3","custom-input",2,"border","2px #000000"],["name","value","formControlName","value",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["id","card-alert",1,"card"],[1,"card-header"],[1,"h6","mb-0","text-center",2,"font-weight","bold"],["class","fas fa-spinner fa-spin",4,"ngIf"],[1,"card-body"],["data-timeline-axis-style","dashed","data-timeline-content","axis",1,"timeline","timeline-one-side"],["class","timeline-block","style","margin-top: -2vh !important;",4,"ngFor","ngForOf"],["audioPlayer",""],["src","assets/notification.mp3","type","audio/mp3"],[3,"value"],[1,"fas","fa-spinner","fa-spin"],[1,"timeline-block",2,"margin-top","-2vh !important"],["title","Ver m\xe1s",1,"timeline-step","badge-warning",2,"cursor","pointer",3,"click"],[1,"timeline-content"],[1,"d-flex","justify-content-between"],[1,"text-sm","font-weight-bold"],[2,"font-weight","500"],[1,"text-right"],[1,"text-muted"],[1,"fas","fa-clock","mr-1"]],template:function(t,e){1&t&&(R.TgZ(0,"div",0),R.TgZ(1,"div",1),R.TgZ(2,"div",2),R.TgZ(3,"div",3),R.TgZ(4,"div",4),R.TgZ(5,"div",5),R.TgZ(6,"strong",6),R._uU(7,"SALA DE MONITOREO"),R.qZA(),R.TgZ(8,"mat-icon",7),R.NdJ("click",function(){return e.centerMap()}),R._uU(9,"center_focus_strong"),R.qZA(),R._UZ(10,"p",8),R.qZA(),R._UZ(11,"br"),R.TgZ(12,"div",3),R.TgZ(13,"div",2),R.TgZ(14,"form",9),R.TgZ(15,"div",10),R.TgZ(16,"mat-form-field",11),R.TgZ(17,"mat-label"),R._uU(18," Teams"),R.qZA(),R.TgZ(19,"mat-select",12),R.NdJ("selectionChange",function(t){return e.selected(t.value)}),R.YNc(20,Tt,2,2,"mat-option",13),R.qZA(),R.qZA(),R.TgZ(21,"div",14),R.TgZ(22,"div",15),R.TgZ(23,"h5",16),R._uU(24," Alertas Pendientes "),R.YNc(25,kt,1,0,"i",17),R.qZA(),R.qZA(),R.TgZ(26,"div",18),R.TgZ(27,"div",19),R.YNc(28,xt,17,7,"div",20),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(29,"audio",null,21),R._UZ(31,"source",22),R._uU(32," Tu navegador no soporta la reproducci\xf3n de audio. "),R.qZA(),R.qZA(),R.qZA()),2&t&&(R.xp6(14),R.Q6J("formGroup",e.searchForm),R.xp6(6),R.Q6J("ngForOf",e.teams),R.xp6(5),R.Q6J("ngIf",e.isLoadingAlerts),R.xp6(3),R.Q6J("ngForOf",e.alerts))},directives:[it.Hw,u._Y,u.JL,u.sg,j.KE,j.hX,Zt.gD,u.JJ,u.u,c.sg,c.O5,bt.ey],pipes:[c.uU],styles:['@charset "UTF-8";#map[_ngcontent-%COMP%]{width:100%;height:75vh!important;position:relative}#card-alert[_ngcontent-%COMP%]{width:35vh;height:30vh;position:absolute;background-color:#fff;opacity:.8;right:2vh;bottom:-2vh;z-index:1000}#card-alert[_ngcontent-%COMP%] > .card-body[_ngcontent-%COMP%]{height:10vh!important;overflow-y:auto!important}.custom-input[_ngcontent-%COMP%]{position:absolute;margin-left:auto;margin-right:auto;right:10px;top:10px;z-index:1000}  .mat-form-field-appearance-outline .mat-form-field-outline{background-color:#fff;border:none!important;border-radius:7px}']}),e}()}]}],St=r(75920),qt=function(){var t=s(function t(){o(this,t)});return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=R.oAB({type:t}),t.\u0275inj=R.cJS({providers:[d.ju],imports:[[c.ez,u.u5,u.UX,l.P4.forRoot(),yt.Rh.forRoot({timeOut:1e4,positionClass:"toast-bottom-right",preventDuplicates:!0}),p.Bz.forChild(wt),g.q,St.K]]}),t}()}}])}();